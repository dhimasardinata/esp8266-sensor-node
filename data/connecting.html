<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Connecting...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #050608;
        --bg-gradient: linear-gradient(
          145deg,
          #050608 0%,
          #0a0d12 50%,
          #0f1318 100%
        );
        --surface: rgba(20, 25, 32, 0.85);
        --surface-2: rgba(30, 37, 48, 0.8);
        --accent: #00d4ff;
        --accent-rgb: 0, 212, 255;
        --accent-secondary: #7c3aed;
        --accent-secondary-rgb: 124, 58, 237;
        --accent-dim: rgba(0, 212, 255, 0.08);
        --text: #f1f5f9;
        --text-secondary: #94a3b8;
        --muted: #64748b;
        --success: #22c55e;
        --success-rgb: 34, 197, 94;
        --error: #ef4444;
        --error-rgb: 239, 68, 68;
        --border: rgba(148, 163, 184, 0.12);
        --radius: 24px;
        --radius-sm: 12px;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 24px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        background: var(--bg-gradient);
        position: relative;
        overflow: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background:
          radial-gradient(
            ellipse 80% 50% at 50% -10%,
            rgba(var(--accent-rgb), 0.1) 0%,
            transparent 60%
          ),
          radial-gradient(
            ellipse 50% 40% at 80% 100%,
            rgba(var(--accent-secondary-rgb), 0.08) 0%,
            transparent 50%
          );
        pointer-events: none;
      }

      .card {
        background: var(--surface);
        backdrop-filter: blur(40px);
        -webkit-backdrop-filter: blur(40px);
        padding: 48px 40px;
        border-radius: var(--radius);
        text-align: center;
        max-width: 420px;
        width: 100%;
        border: 1px solid var(--border);
        position: relative;
        overflow: hidden;
        box-shadow:
          0 25px 50px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.03);
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--accent),
          var(--accent-secondary),
          var(--accent)
        );
        background-size: 200% 100%;
        animation: gradientShift 3s ease infinite;
      }

      @keyframes gradientShift {
        0%,
        100% {
          background-position: 0% 50%;
        }

        50% {
          background-position: 100% 50%;
        }
      }

      .card.success::before {
        background: var(--success);
        animation: none;
      }

      .card.fail::before {
        background: var(--error);
        animation: none;
      }

      .card.success {
        box-shadow:
          0 25px 50px rgba(0, 0, 0, 0.4),
          0 0 60px rgba(var(--success-rgb), 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.03);
      }

      .card.fail {
        box-shadow:
          0 25px 50px rgba(0, 0, 0, 0.4),
          0 0 60px rgba(var(--error-rgb), 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.03);
      }

      .icon-wrap {
        margin-bottom: 28px;
        position: relative;
      }

      .spinner {
        width: 64px;
        height: 64px;
        border: 3px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
        position: relative;
        box-shadow:
          0 0 30px rgba(var(--accent-rgb), 0.2),
          inset 0 0 20px rgba(var(--accent-rgb), 0.05);
      }

      .spinner::after {
        content: "";
        position: absolute;
        inset: -8px;
        border-radius: 50%;
        border: 2px solid transparent;
        border-top-color: rgba(var(--accent-secondary-rgb), 0.3);
        animation: spin 1.5s linear reverse infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .icon {
        font-size: 64px;
        line-height: 1;
        filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3));
      }

      .icon.success-icon {
        background: linear-gradient(135deg, var(--success), #4ade80);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: successPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .icon.error-icon {
        color: var(--error);
      }

      @keyframes successPop {
        0% {
          transform: scale(0);
          opacity: 0;
        }

        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      h1 {
        font-size: 1.6rem;
        margin-bottom: 12px;
        font-weight: 800;
        letter-spacing: -0.02em;
        background: linear-gradient(
          135deg,
          var(--text) 0%,
          var(--accent) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .card.success h1 {
        background: linear-gradient(
          135deg,
          var(--text) 0%,
          var(--success) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .card.fail h1 {
        background: linear-gradient(
          135deg,
          var(--text) 0%,
          var(--error) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      p {
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.6;
        font-weight: 500;
      }

      .detail {
        font-size: 0.8rem;
        margin-top: 24px;
        padding: 14px 18px;
        background: var(--surface-2);
        border-radius: var(--radius-sm);
        color: var(--muted);
        border: 1px solid var(--border);
        font-weight: 500;
      }

      .progress-wrap {
        margin-top: 28px;
        background: var(--surface-2);
        border-radius: 8px;
        height: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
      }

      .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(
          90deg,
          var(--accent),
          var(--accent-secondary)
        );
        border-radius: 8px;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s ease-in-out infinite;
      }

      @keyframes shimmer {
        100% {
          left: 100%;
        }
      }

      @media (max-width: 480px) {
        .card {
          padding: 40px 28px;
        }

        h1 {
          font-size: 1.4rem;
        }

        .spinner {
          width: 56px;
          height: 56px;
        }
      }
    </style>
  </head>

  <body>
    <div class="card" id="card">
      <div class="icon-wrap" id="icon-wrap">
        <div class="spinner"></div>
      </div>
      <h1 id="title">Connecting...</h1>
      <p id="msg">Attempting to connect to your WiFi network</p>
      <div class="progress-wrap">
        <div class="progress-bar" id="progress"></div>
      </div>
      <div class="detail" id="detail">This may take up to 20 seconds</div>
    </div>

    <script>
      const card = document.getElementById("card");
      const iconWrap = document.getElementById("icon-wrap");
      const title = document.getElementById("title");
      const msg = document.getElementById("msg");
      const progress = document.getElementById("progress");
      const detail = document.getElementById("detail");

      let elapsed = 0;
      const maxTime = 20;

      const intervalId = setInterval(async () => {
        elapsed += 2;
        progress.style.width = Math.min((elapsed / maxTime) * 100, 95) + "%";

        try {
          const res = await fetch("/status");
          const data = await res.json();

          msg.textContent = data.message || "Connecting...";
          if (data.detail) detail.textContent = data.detail;

          if (data.status === "success") {
            clearInterval(intervalId);
            progress.style.width = "100%";
            card.classList.add("success");
            title.textContent = "Connected!";
            iconWrap.innerHTML = '<div class="icon success-icon">✓</div>';
            detail.textContent = "Device will restart shortly...";
            setTimeout(() => {
              window.location.href = "/success";
            }, 2000);
          } else if (data.status === "fail") {
            clearInterval(intervalId);
            card.classList.add("fail");
            title.textContent = "Connection Failed";
            iconWrap.innerHTML = '<div class="icon error-icon">✗</div>';
            detail.textContent = "Returning to setup...";
            setTimeout(() => {
              window.location.href = "/";
            }, 3000);
          }
        } catch (e) {
          clearInterval(intervalId);
          card.classList.add("fail");
          title.textContent = "Connection Lost";
          msg.textContent = "Could not reach the device";
          iconWrap.innerHTML = '<div class="icon error-icon">⚠</div>';
          detail.textContent = "Please reconnect to the device WiFi";
        }
      }, 2000);
    </script>
  </body>
</html>

